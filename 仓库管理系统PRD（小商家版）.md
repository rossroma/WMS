# 仓库管理系统PRD（小商家版）

**版本号**：V2.1
**发布日期**：2025年5月7日
**更新日期**：2025年6月18日

------

## 一、系统概述

为中小型商超/电商商家提供轻量化的仓储管理解决方案，支持基础的商品管理、采购订单管理、出入库流程、库存监控及多角色协作，**适配PC端**。

**当前实现状态**：项目已完成核心功能模块的开发和部署，包括前后端分离架构、数据库设计、用户权限管理、业务流程自动化、采购订单管理等。

------

## 二、核心模块需求

### 1. 商品管理

- **基础信息录入**
  
  ▶ 字段：名称（必填）、品牌、图片、规格（如"500ml/瓶"）、编号、分类、单位、产品简介、供应商、库存预警数量、采购价（必填）、建议零售价、所属仓库/货架、创建人
  
  ▶ 删除规则：存在出入库记录的商品需先清空库存才能删除

- **商品分类**
  
  ▶ 三级分类体系（例：食品→休闲零食→薯片）
  
  ▶ 支持分类的增删改查操作

- **供应商管理**
  
  ▶ 字段：名称、联系人、地址、邮箱、电话、信用等级、结算方式、负责人

### 2. 采购订单管理

- **采购订单**
  
  ▶ 字段：订单编号（自动生成）、供应商、采购日期、预计到货日期、订单状态（未确认/已确认）、付款状态（未付款/部分付款/已付款）、付款方式、总金额、总数量、操作员、备注
  
  ▶ 状态管理：PENDING（未确认）→ CONFIRMED（已确认）

- **采购商品明细**
  
  ▶ 字段：商品信息、规格、单位、采购数量、单价、金额
  
  ▶ 支持商品选择弹窗，批量添加商品
  
  ▶ 实时计算总数量和总金额

- **采购流程**
  
  ▶ 创建采购订单：选择供应商、添加采购商品、设置采购信息，**自动生成采购明细**
  
  ▶ 确认采购订单：状态变更为已确认，**自动生成采购入库单**
  
  ▶ 删除采购订单：**检查关联入库单，如存在则不允许删除**，确保数据一致性

- **库存同步**
  
  ▶ 确认采购订单时自动创建入库单，设置关联采购单ID
  
  ▶ 自动更新商品库存数量
  
  ▶ 生成库存变动流水记录
  
  ▶ 前端显示入库单的关联来源（采购单、盘点单、手动创建）

### 3. 出入库管理 

- **入库单**
  
  ▶ 编号、类型（补货入库、盘盈入库、退货入库、**采购入库**）、入库日期、入库商品（名称、编号、规格、数量、单位、备注）、入库数量小计（自动计算）、操作人、**关联来源**（采购单、盘点单、手动创建）
  
  ▶ **入库流程**：创建入库单→生成订单明细→更新库存→创建库存流水
  
  ▶ **删除入库单**：删除明细→回退库存→删除库存流水

- **出库单**
  
  ▶ 编号、类型（销售出库、盘亏出库）、出库日期、出库商品（名称、编号、规格、数量、单位、备注）、出库数量小计（自动计算）、操作人、**关联来源**（盘点单、手动创建）
  
  ▶ **出库流程**：创建出库单→生成订单明细→更新库存→创建库存流水
  
  ▶ **删除出库单**：删除明细→恢复库存→删除库存流水

### 4. 库存管理

- **库存查询**
  
  ▶ 多条件筛选：商品名称/编号/分类/库存数量
  
  ▶ 字段：名称（必填）、品牌、图片、规格（如"500ml/瓶"）、编号、分类、单位、库存数量

- **库存流水**
  
  ▶ 字段：名称、发生数量、业务类型、业务日期、关联单据、操作人

- **商品盘点**
  
  ▶ 字段：盘点编号、盘点日期、盘点商品（名称、编号、规格、单位、**系统库存数量**、**实际盘点数量**）、备注、盘点准确率（自动计算）、操作人
  
  ▶ **盘点流程**：
    - 创建盘点单→自动生成盘点明细（系统库存快照）
    - 录入实际盘点数量→系统自动计算盘盈盘亏
    - 盘盈处理→自动创建盘盈入库单，增加库存
    - 盘亏处理→自动创建盘亏出库单，减少库存
    - **删除盘点单**→检查关联出入库单，如存在则不允许删除

### 5. 消息管理

- **通知机制**：站内信

- **通知类型**：
  
  ▶ 库存预警提醒
  
  ▶ 盘盈入库提醒
  
  ▶ 盘亏出库提醒

- **消息功能**：
  
  ▶ 消息状态管理（已读/未读）
  
  ▶ 批量标记已读
  
  ▶ 消息分类筛选
  
  ▶ 消息历史记录查询

### 6. 权限与用户体系

- **角色权限**（基于角色等级的权限控制）

  | 角色 | 权限等级 | 权限范围 |
  | :--: | :------: | :------: |
  | 超级管理员（admin） | 3 | 全功能+系统管理+用户管理+日志管理 |
  | 管理员（manager） | 2 | 业务管理+商品管理+供应商管理+采购订单管理+出入库管理 |
  | 操作员（operator） | 1 | 基础查询+库存查看+消息查看 |

- **用户管理功能**：
  
  ▶ 用户信息管理：姓名、用户名、邮箱、电话、角色、状态
  
  ▶ 密码管理：修改密码、重置密码
  
  ▶ 用户状态控制：启用/禁用
  
  ▶ 权限分配：角色权限动态分配

- **操作日志 **
  
  ▶ 记录关键操作（如库存调整、单据删除、用户管理）
  
  ▶ 日志查询和审计功能

### 7. 数据看板 

- **实时数据概览**：
  
  ▶ 今日入库/出库数量
  
  ▶ 库存总量和商品种类
  
  ▶ 库存总价值
  
  ▶ 库存预警商品数量

- **库存预警看板**：
  
  ▶ 预警商品列表
  
  ▶ 预警商品详情查看

- **数据分析图表**：
  
  ▶ 近7天出入库趋势图（ECharts）
  
  ▶ 热门商品TOP10排行榜

- **盘点统计**：
  
  ▶ 盘点准确率计算（最近30天）

------

## 三、技术实现

### 1. 系统架构 

**前端技术栈**：
- Vue 3 - 前端框架
- Element Plus - UI组件库
- Vue Router - 路由管理
- Pinia - 状态管理
- Axios - HTTP客户端
- ECharts - 图表库
- Vite - 构建工具

**后端技术栈**：
- Node.js - 运行环境
- Express.js - Web框架
- Sequelize - ORM数据库操作
- MySQL 8.0 - 数据库
- JWT - 身份认证
- bcryptjs - 密码加密
- Winston - 日志管理
- Node-cron - 定时任务

### 2. 数据库设计 

**核心数据表**：
- users - 用户表
- suppliers - 供应商表
- categories - 商品分类表
- products - 商品表
- inventories - 库存表
- **purchase_orders - 采购订单表**
- **purchase_order_items - 采购订单明细表**
- inbound_orders - 入库单表
- outbound_orders - 出库单表
- order_items - 订单明细表
- stocktaking_orders - 盘点单表
- stocktaking_items - 盘点明细表
- inventory_logs - 库存变动日志表
- messages - 消息通知表
- logs - 操作日志表

### 3. 服务层架构

**新增服务层**：
- **inboundOrderService** - 入库单服务层
  
  ▶ 统一入库单创建逻辑
  
  ▶ 自动库存更新和流水记录
  
  ▶ 支持多种入库类型（采购入库、盘盈入库等）

### 4. 部署方案 

- **容器化部署**：Docker + Docker Compose
- **数据库**：MySQL 8.0 容器化部署
- **环境配置**：通过环境变量管理配置

### 5. 安全特性 

- **身份认证**：JWT Token认证
- **密码安全**：bcryptjs加密存储
- **权限控制**：基于角色的访问控制（RBAC）
- **错误处理**：统一错误处理机制

------

## 四、项目状态

### 已完成功能模块

✅ **用户认证与权限管理**
✅ **商品管理**
✅ **供应商管理**
✅ **采购订单管理** - **V2.1新增**
✅ **库存管理**
✅ **出入库管理**
✅ **盘点管理**
✅ **消息通知系统**
✅ **数据看板**
✅ **操作日志**
✅ **系统管理**

### V2.1 版本更新内容

🆕 **采购订单管理模块**
- 采购订单CRUD操作
- 采购商品明细管理
- 订单状态流转（未确认→已确认）
- 确认订单自动生成入库单
- 删除订单自动处理关联数据和库存回退

🆕 **业务流程自动化**
- 采购确认自动创建入库单
- 自动更新库存数量和生成流水记录
- 删除已确认订单时自动回退库存变更

🆕 **服务层架构优化**
- 新增入库单服务层（inboundOrderService）
- 统一入库单创建和删除逻辑
- 提高代码复用性和维护性

🆕 **数据库结构扩展**
- 新增采购订单表（purchase_orders）
- 新增采购订单明细表（purchase_order_items）
- 采购订单状态枚举：PENDING/CONFIRMED

### 部署信息

- **前端端口**：5173（开发环境）
- **后端端口**：3000
- **数据库端口**：3306
- **默认管理员账号**：admin/123456

### 待优化功能

🔄 **单据打印功能** - 需要完善打印模板
🔄 **批量操作优化** - 批量入库、出库操作
🔄 **高级报表** - 更多维度的数据分析报表
🔄 **采购订单编辑功能** - 已确认订单的编辑限制

------

## 五、项目部署指南

### 环境要求
- Node.js 16+
- Docker & Docker Compose
- MySQL 8.0+

### 快速启动
```bash
# 1. 启动数据库
cd backend && docker-compose up -d

# 2. 启动后端服务
npm install && npm start

# 3. 启动前端服务
cd ../frontend && npm install && npm run dev
```

### 访问地址
- 前端：http://localhost:5173
- 后端API：http://localhost:3000
